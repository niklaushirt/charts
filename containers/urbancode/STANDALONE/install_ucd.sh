#!/bin/bash

export SERVER_ADDR="9.30.250.6"
export SERVER_PORT_UI="9999"
export SERVER_PORT_JMS="7918"
export SERVER_PORT_HTTP="7919"
export SERVER_PATH=/opt/ibm-ucd/server

echo "-----------------------------------------------------------------------------"
echo "-----------------------------------------------------------------------------"
echo "  Server will be configured as follows "
echo "-----------------------------------------------------------------------------"
echo "UCD Server Address      : "$SERVER_ADDR
echo "UCD Server UI Port      : "$SERVER_PORT_UI
echo "UCD Server JMS Port     : "$SERVER_PORT_JMS
echo "UCD Server HTTP Port    : "$SERVER_PORT_HTTP
echo "UCD Server Directory    : "$SERVER_PATH

echo "-----------------------------------------------------------------------------"
echo "-----------------------------------------------------------------------------"


mkdir -p ~/tmp/ucds-install
cd ~/tmp/ucds-install
cp ~/install.properties .

#-----------------------------------------------------------------------------------------------------------------
# Download UCDS
#-----------------------------------------------------------------------------------------------------------------
echo "-----------------------------------------------------------------------------------------------------------------"
echo "-----------------------------------------------------------------------------------------------------------------"
echo "DOWNLOADING UCDS"
echo "-----------------------------------------------------------------------------------------------------------------"
echo "-----------------------------------------------------------------------------------------------------------------"

wget https://www.dropbox.com/s/2t00hzfn7p694av/URBANCODE_DEPLOY_V7.0.0_MP_ML.zip?dl=0
mv URBANCODE_DEPLOY_V7.0.0_MP_ML.zip\?dl=0 URBANCODE_DEPLOY_V7.0.0_MP_ML.zip

unzip URBANCODE_DEPLOY_V7.0.0_MP_ML.zip

echo "-----------------------------------------------------------------------------------------------------------------"
echo "-----------------------------------------------------------------------------------------------------------------"
echo "DOWNLOADING Config"
echo "-----------------------------------------------------------------------------------------------------------------"
echo "-----------------------------------------------------------------------------------------------------------------"

cat ./install.properties > ./ibm-ucd-install/install.properties

echo "-----------------------------------------------------------------------------------------------------------------"
echo "-----------------------------------------------------------------------------------------------------------------"
echo "INSTALL UCDS"
echo "-----------------------------------------------------------------------------------------------------------------"
echo "-----------------------------------------------------------------------------------------------------------------"
cd ./ibm-ucd-install

export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64/jre/
./install-server.sh


# 	rm -rf /tmp/ibm-ucd-install
# 	rm -f /tmp/install.properties

echo "-----------------------------------------------------------------------------------------------------------------"
echo "-----------------------------------------------------------------------------------------------------------------"
echo "DONE"
echo "-----------------------------------------------------------------------------------------------------------------"
echo "-----------------------------------------------------------------------------------------------------------------"

mkdir -p ~/tmp/ucda-install
cd ~/tmp/ucda-install
wget https://9.30.250.6:9999/tools/ucd-agent.zip --no-check-certificate
unzip ucd-agent.zip
cd ucd-agent-install
